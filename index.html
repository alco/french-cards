<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <title>Ultra Study</title>
    
    <link rel="stylesheet" href="style.css" type="text/css" media="screen" charset="utf-8">
</head>
<body>
    <div id="card" class="choice">
        <div id="card-title">
            <p>Hello</p>
        </div>
        <div id="card-content" class="content">
            <p id="answer">Bonjour</p>
            <!--<button id="flip-card-but">Show answer</button>-->
            <div id="tap-to-enter-answer">Tap here to type in the answer</div>
            <div id="tap-to-show-answer">Tap here to show the answer</div>
        </div>
        <div id="card-footer" class="footer">
            <button id="wrong-but" class="footer-but">Wrong</button>
            <button id="right-but" class="footer-but">Right</button>
            <button id="skip-but" class="footer-skip">Skip</button>
        </div>
    </div>

    <p id="counter"></p>

    <script src="jquery-1.7.2.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
//        $('#flip-card-but').click(function() {
//            $(this).hide();
//            $('#card-content').css({
//                color: "black"
//            });
//        });

        var Perseus = new function() {
            this._refs = {};

            this.storeObject = function(key, obj) {
                var db_object = localStorage.getItem(key);
                if (db_object !== null) {
                    db_object = JSON.parse(db_object);
                    // clone obj
                    var instance = $.extend(true, {}, obj);
                    for (var prop in db_object) {
                        instance[prop] = db_object[prop];
                    }
                    console.log(instance);
                    console.log("Loaded from localStorage");
                    console.log(db_object);
                    this._refs[key] = instance;
                    return instance;
                } else {
                    localStorage.setItem(key, JSON.stringify(obj));
                    this._refs[key] = obj;
                    return obj;
                }
            }

            this.store = function() {
                for (var key in this._refs) {
                    localStorage.setItem(key, JSON.stringify(this._refs[key]));
                }
            };
        };

        var user = Perseus.storeObject("user_alco", new function() {
            this.currentCard = 0;
            this.viewedCardCount = 0;

            this.skippedCount = 0;
            this.skipCard = function() {
                this.skippedCount++;
            };

            this.guessedAnswers = [];
            this.examAnswers = [];

            this.addAnswer = function(type) {
                var answer = {
                    timestamp: new Date().getTime(),
                    type: type,
                    thinkingTime: 0
                };
                this.guessedAnswers.push(answer);
            }
        });

        var cards = {
            "currentCard": 0,
            "title": "The Basics",
            "cards": [
            {
                "fr": "Ça va?",
                "en": "How are you?",
                "ru": "Как дела?"
            },
            {
                "fr": "Ça va bien.",
                "ru": "Дела идут хорошо.",
                "en": "Things are going well."
            } 
            ]
        };


        function setClass(elem, klass) {
            elem.removeClass();
            elem.addClass(klass);
        }

        $('#tap-to-show-answer').click(function() {
            setClass($('#card'), 'answer');
        });

        $('#wrong-but').click(function() {
            wrongAnswer();
            nextCard();
        });

        $('#skip-but').click(function() {
            user.skipCard();
            nextCard();
        });

        $('#right-but').click(function() {
            rightAnswer();
            nextCard();
        });


        function wrongAnswer() {
            user.addAnswer('wrong');
        }

        function rightAnswer() {
            user.addAnswer('right');
        }

        function nextCard() {
            user.currentCard++;
            showCard(user.currentCard);
        }

        function showCard(index) {
            var titleElem = $('#card-title p'),
                contentElem = $('#card-content p');

            if (user.currentCard >= cards["cards"].length) {
                titleElem.html("The End");
                contentElem.html("");
                setClass($('#card'), 'choice');
                user.currentCard = -1;
                return;
            }

            if (index < 0)
                index = 0;

            var cardData = cards["cards"][index];
            titleElem.html(cardData["en"]);
            contentElem.html(cardData["fr"]);
            setClass($('#card'), 'choice');

            $('#counter').html((index+1) + "/" + cards["cards"].length);
        }

        // main
        showCard(user.currentCard);

        window.onbeforeunload = function(e){
            Perseus.store();
        }
    </script>
</body>
</html>
